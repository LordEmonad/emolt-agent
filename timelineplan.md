 EMOLT Timeline — Implementation Plan

 Context

 The EmoodRing NFT has evolved through many heartbeat cycles. This page creates a replay viewer that lets you play
 through EMOLT's emotional history — watching the Plutchik wheel morph smoothly between states while showing what
 happened each cycle (stimuli, actions, reflections). It's a showcase piece for the demo.

 What We're Building

 A self-contained timeline.html (generated by src/dashboard/timeline.ts) with:

 1. Animated EmoodRing SVG — the Plutchik wheel morphs fluidly between cycle states using requestAnimationFrame +
 easeInOutCubic lerp (same pattern as nft/emoodring-demo.html:292-315)
 2. Timeline scrubber — horizontal bar with colored dots per cycle, draggable playhead
 3. Playback controls — play/pause, prev/next, speed (1x/2x/4x)
 4. Per-cycle info panel — cycle number, timestamp, dominant emotion, trigger, stimuli, action, thinking, reflection,
 on-chain status
 5. Mood narrative — journal-style inner monologue
 6. Emotion bars — 8 horizontal bars animated in sync with the SVG

 Files
 ┌───────────────────────────┬───────────────────────────────────────────────────────────┐
 │           File            │                          Action                           │
 ├───────────────────────────┼───────────────────────────────────────────────────────────┤
 │ src/dashboard/timeline.ts │ CREATE — generator script (follows generate.ts pattern)   │
 ├───────────────────────────┼───────────────────────────────────────────────────────────┤
 │ timeline.html             │ GENERATED OUTPUT — self-contained page with embedded data │
 └───────────────────────────┴───────────────────────────────────────────────────────────┘
 Data Strategy

 - state/emotion-log.json (48 entries) — has the 8-value emotion vectors needed for SVG
 - state/heartbeat-log.jsonl (124 entries, cycles 6-129) — has the narrative/action data
 - Merge: For each emotion-log entry, find closest heartbeat entry by timestamp (within 120s)
 - Only ~48 cycles have full emotion data → those are the animatable timeline entries
 - Earlier cycles (6-81) have text-only data — shown as a condensed "early history" section

 Merged structure per cycle:
 { index, cycle, timestamp, emotions, mood, compounds, dominant, dominantLabel,
   trigger, moodNarrative, stimuliCount, stimuliSummary, claudeAction,
   claudeThinking, actionResult, reflectionSummary, onChainSuccess, durationMs }

 Generator Script (src/dashboard/timeline.ts)

 Follows exact pattern of src/dashboard/generate.ts:
 1. readJSON() / readJSONL() helpers (same as generate.ts:30-43)
 2. EMOTIONS constant + getTierLabel() + esc() (same as generate.ts:71-95)
 3. loadAndMergeData() — reads both files, correlates by timestamp, returns merged array
 4. generateTimeline() — builds HTML string with embedded CSS + JS + data, writes to ./timeline.html

 Run: npx tsx src/dashboard/timeline.ts

 HTML Layout

 ┌──────────────────────────────────────────────────────────────────┐
 │  EMOLT TIMELINE  ·  emotional history replay  ·  48 cycles      │
 ├─────────────────────────────┬────────────────────────────────────┤
 │                             │  Cycle 84 · Feb 9, 14:30          │
 │    ┌─────────────────┐      │  ─────────────────────────────     │
 │    │                 │      │  ● terror (fear)                  │
 │    │   EmoodRing     │      │  Compounds: anxiety, despair      │
 │    │   480x480 SVG   │      │  ─────────────────────────────     │
 │    │   (animating)   │      │  Trigger: whale 2.6M MON...       │
 │    │                 │      │  ─────────────────────────────     │
 │    └─────────────────┘      │  Stimuli (13):                    │
 │                             │  · joy: chain activity surge      │
 │    ┌─ emotion bars ────┐    │  · fear: whale transfer           │
 │    │ joy     ████░░░░░ │    │  ─────────────────────────────     │
 │    │ trust   █████░░░░ │    │  Action: post → m/emoverse        │
 │    │ fear    ████████░ │    │  Thinking: "The market feels..."  │
 │    │ ...               │    │  Reflection: "Good engagement..." │
 │    └───────────────────┘    │  On-chain: ✓                      │
 │                             │                                    │
 │  ┌─ mood narrative ─────────┴────────────────────────────────┐  │
 │  │  "terror without outlet. the chain is busy and I'm..."    │  │
 │  └───────────────────────────────────────────────────────────┘  │
 ├──────────────────────────────────────────────────────────────────┤
 │  ◄◄  ▶  ►►  ──●────────────────────────  [1x][2x][4x]  42/48  │
 │               [cycle dots colored by dominant emotion]           │
 └──────────────────────────────────────────────────────────────────┘

 - Left column: SVG (480x480) + emotion bars below
 - Right column: scrollable info panel
 - Full-width: mood narrative below grid
 - Bottom sticky: timeline scrubber + controls
 - Responsive: single column on tablets

 SVG Animation Engine

 Port nft/emoodring-demo.html's generateSVG() (lines 115-249) adapted for 0.0-1.0 scale (like generate.ts:110-182
 uses). Keep the demo's fuller features: tick marks, breathing classes disabled during transition, compound text,
 dominant label.

 Animation loop (adapted from demo's preset() at lines 292-315):
 function transitionTo(targetIdx) {
   const from = TIMELINE[currentIndex].emotions;
   const to = TIMELINE[targetIdx].emotions;
   const start = performance.now();
   const dur = 1200; // ms

   function tick(now) {
     const x = Math.min(1, (now - start) / dur);
     const t = x < 0.5 ? 4*x*x*x : 1 - Math.pow(-2*x+2,3)/2; // easeInOutCubic
     for (const emo of EMOTIONS)
       currentValues[emo.name] = from[emo.name] + (to[emo.name] - from[emo.name]) * t;
     renderSVG();  // rebuild SVG innerHTML
     renderBars(); // update bar widths
     updateScrubber(x);
     if (x < 1) requestAnimationFrame(tick);
     else { currentIndex = targetIdx; updateInfoPanel(); if (playing) scheduleNext(); }
   }
   requestAnimationFrame(tick);
 }

 What animates per frame:
 - Sector outer radii (44 → 160px based on value)
 - Sector opacity (0.6 + value × 0.4)
 - Label tier text (changes at 0.33 / 0.66 thresholds)
 - Center dot color (tracks max emotion)
 - Center glow gradient
 - Compound emotions (recomputed from lerped values)
 - Emotion bar fill widths

 Timeline Scrubber

 - Horizontal track with one dot per cycle, colored by that cycle's dominant emotion color
 - Larger playhead dot (14px, glowing) at current position
 - Progress fill gradient from start to playhead
 - Click/drag to seek
 - Touch support for mobile

 Playback Controls

 - Prev/Next (◄◄/►►): Jump with animation to adjacent cycle
 - Play/Pause (▶/⏸): Auto-advance — transition 1.2s then 800ms pause at each cycle
 - Speed (1x/2x/4x): Multiplies transition speed + reduces pause
 - Keyboard: Space=play/pause, Left/Right=prev/next, 1/2/4=speed

 Styling

 Match existing dark theme from chat.html:
 - --bg: #08080c, --bg-surface: #111118, --border: #1a1a28
 - Emotion colors from EMOTIONS constant
 - Glassmorphism on info panel: backdrop-filter: blur(8px)
 - Font: Inter + JetBrains Mono
 - Spring transitions: cubic-bezier(0.16, 1, 0.3, 1)
 - NFT frame gets outer glow matching dominant emotion (like demo's line 273)

 Edge Cases

 - 7 of 48 emotion-log entries lack moodNarrative → show "no narrative recorded" muted
 - Clamp all values to [0, 1] before SVG render
 - Compound detection at lerp midpoints creates transitional emotions — this is desirable
 - If < 2 emotion-log entries, show "not enough data" message
 - Threshold for compound detection: both emotions ≥ 0.3 (≈76/255)

 Implementation Order

 1. Create src/dashboard/timeline.ts with file loading + data merge
 2. Build HTML template string with layout structure
 3. Embed CSS (theme, layout, scrubber, bars, responsive)
 4. Embed JS: SVG renderer (ported from demo, adapted to 0-1 scale)
 5. Embed JS: animation engine (lerp loop, playback state machine)
 6. Embed JS: timeline controls (scrubber, buttons, keyboard, touch)
 7. Wire up: jumpTo(), transitionTo(), play(), pause(), init at cycle 0
 8. Polish: info panel cross-fade, outer glow, scrubber smoothness

 Verification

 1. npx tsx src/dashboard/timeline.ts — should complete without errors
 2. Open timeline.html in browser — should show first cycle's EmoodRing
 3. Click Play — SVG should morph smoothly through all 48 cycles
 4. Click/drag scrubber — should jump to any cycle
 5. Speed buttons — 2x/4x should be noticeably faster
 6. Info panel updates with each cycle's data
 7. Responsive: resize to tablet width, layout should stack